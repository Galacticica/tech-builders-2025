{% extends "base.html" %}

{% load static %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'view_creation.css' %}">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/trix/2.0.0/trix.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/2.0.0/trix.umd.min.js"></script>
{% endblock %}


{% block content %}
<div class="post-container">
  <div class="post-header">
    <h1>{{ post.title }}</h1>
    <div class="post-meta">
      <span>üìÇ {{ post.post_type }}</span>
      <span>üë§ {{ post.author }}</span>
      <span>üéØ {{ post.area_of_focus }}</span>
      <span>‚è∞ {{ post.created_at }}</span>
      <span>üîó <a href="{{ post.demo }}" target="_blank">{{ post.demo_link }}</a></span>
    </div>
  </div>

  <!-- ‚úÖ Description goes here -->
  <div class="post-description">
    <p>{{ post.content }}</p>
  </div>
</div>




{% if post.media.all %}
    {% for media in post.media.all %}
        <div class="w-72 h-48 overflow-hidden flex items-center justify-center bg-gray-100 rounded" style="margin-bottom: 1em;">
            {% if media.url|lower|slice:'-4:' == '.jpg' or media.url|lower|slice:'-5:' == '.jpeg' or media.url|lower|slice:'-4:' == '.png' or media.url|lower|slice:'-4:' == '.gif' %}
                <img src="{{ media.url }}" class="max-w-full max-h-full object-contain" />
            {% elif 'youtube.com' in media.url|lower or 'youtu.be' in media.url|lower %}
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{{ media.url|cut:'https://youtu.be/'|cut:'https://www.youtube.com/watch?v=' }}" frameborder="0" allowfullscreen></iframe>
            {% elif media.url|lower|slice:'-4:' == '.mp4' or media.url|lower|slice:'-5:' == '.webm' or media.url|lower|slice:'-4:' == '.ogg' %}
                <video controls class="max-w-full max-h-full object-contain">
                    <source src="{{ media.url }}">
                    Your browser does not support the video tag.
                </video>
            {% else %}
                <a href="{{ media.url }}" target="_blank">View Media</a>
            {% endif %}
        </div>
    {% endfor %}
{% endif %}

<h2>Discussion</h2>

    <div id="messages">
        {% for message in messages %}
            <div class="message">
                <strong>{{ message.author }}</strong> <em>{{ message.timestamp }}</em><br>
                {{ message.body|safe }}
                <div class="replies">
                    {% for reply in message.get_replies %}
                        <div class="reply">
                            <strong>{{ reply.author }}</strong> <em>{{ reply.timestamp }}</em><br>
                            {{ reply.body|safe }}
                        </div>
                    {% endfor %}
                </div>
                <form method="post" class="reply-form">
                    {% csrf_token %}
                    <input id="trix-body-{{ message.id }}" type="hidden" name="body" value="">
                    <trix-editor input="trix-body-{{ message.id }}" class="form-control"></trix-editor>
                    <input type="hidden" name="parent_id" value="{{ message.id }}">
                    <button type="submit">Reply</button>
                </form>
            </div>
        {% empty %}
            <p>No messages yet. Be the first to comment!</p>
        {% endfor %}
    </div>

    <h3>New Message</h3>
<form method="post" class="new-message-form">
    {% csrf_token %}
    <div class="editor-wrapper">
        <input id="trix-body-main" type="hidden" name="body" value="">
        <trix-editor input="trix-body-main" class="form-control"></trix-editor>
    </div>
    <button type="submit">Post Message</button>
</form>

</div>

{% endblock %}