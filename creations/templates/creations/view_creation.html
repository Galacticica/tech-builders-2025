{% extends "base.html" %}

{% load static %}

    {% block head %}
        <link rel="stylesheet" type="text/css" href="{% static 'view_event.css' %}">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/trix/2.0.0/trix.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/trix/2.0.0/trix.umd.min.js"></script>
    {% endblock %}

    {% block content %}
    <div class="event-container">
        <h1 class="event-title">{{ post.title }}</h1>

        {% if post.media.all %}
            <div class="event-media">
                {% for media in post.media.all %}
                    <div class="media-item">
                        {% if media.url|lower|slice:'-4:' == '.jpg' or media.url|lower|slice:'-5:' == '.jpeg' or media.url|lower|slice:'-4:' == '.png' or media.url|lower|slice:'-4:' == '.gif' %}
                            <img src="{{ media.url }}" />
                        {% elif 'youtube.com' in media.url|lower or 'youtu.be' in media.url|lower %}
                            <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{{ media.url|cut:'https://youtu.be/'|cut:'https://www.youtube.com/watch?v=' }}" frameborder="0" allowfullscreen></iframe>
                        {% elif media.url|lower|slice:'-4:' == '.mp4' or media.url|lower|slice:'-5:' == '.webm' or media.url|lower|slice:'-4:' == '.ogg' %}
                            <video controls>
                                <source src="{{ media.url }}">
                                Your browser does not support the video tag.
                            </video>
                        {% else %}
                            <a href="{{ media.url }}" target="_blank">View Media</a>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <div class="event-meta">
            <p><strong>üìÇ Category:</strong> {{ post.post_type }}</p>
            <p><strong>üìù Description:</strong> {{ post.content }}</p>
            <p><strong>üë§ Created by:</strong> {{ post.author }}</p>
            <p><strong>üéØ Area of Focus:</strong> {{ post.area_of_focus }}</p>
            <p><strong>‚è∞ Created at:</strong> {{ post.created_at }}</p>
            {% if post.demo_link %}
            <p><strong>üîó Demo:</strong> <a href="{{ post.demo_link }}" target="_blank">{{ post.demo_link }}</a></p>
            {% endif %}
        </div>

        <hr>

        <h2>Discussion</h2>
        <div id="messages">
            {% for message in messages %}
                <div class="message">
                    <strong>{{ message.author }}</strong> <em>{{ message.timestamp }}</em><br>
                    {{ message.body|safe }}
                    <div class="replies">
                        {% for reply in message.get_replies %}
                            <div class="reply">
                                <strong>{{ reply.author }}</strong> <em>{{ reply.timestamp }}</em><br>
                                {{ reply.body|safe }}
                            </div>
                        {% endfor %}
                    </div>
                    <form method="post" class="reply-form">
                        {% csrf_token %}
                        <input id="trix-body-{{ message.id }}" type="hidden" name="body" value="">
                        <trix-editor input="trix-body-{{ message.id }}" class="form-control"></trix-editor>
                        <input type="hidden" name="parent_id" value="{{ message.id }}">
                        <button type="submit">Reply</button>
                    </form>
                </div>
            {% empty %}
                <p>No messages yet. Be the first to comment!</p>
            {% endfor %}
        </div>

        <h3>New Message</h3>
        <form method="post" class="new-message-form">
            {% csrf_token %}
            <div class="editor-wrapper">
                <input id="trix-body-main" type="hidden" name="body" value="">
                <trix-editor input="trix-body-main" class="form-control"></trix-editor>
            </div>
            <button type="submit">Post Message</button>
        </form>
    </div>
    {% endblock %}