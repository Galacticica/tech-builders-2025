{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'view_project.css' %}">
{% endblock %}

{% block content %}

<div class="post-container">
    <h1>{{ post.title }}</h1>
    <p class="post-meta">Category: {{ post.post_type }}</p>

    
{% if post.media.all %}
    {% for media in post.media.all %}
        <div class="w-72 h-48 overflow-hidden flex items-center justify-center bg-gray-100 rounded" style="margin-bottom: 1em;">
            {% if media.url|lower|slice:'-4:' == '.jpg' or media.url|lower|slice:'-5:' == '.jpeg' or media.url|lower|slice:'-4:' == '.png' or media.url|lower|slice:'-4:' == '.gif' %}
                <img src="{{ media.url }}" class="max-w-full max-h-full object-contain" />
            {% elif 'youtube.com' in media.url|lower or 'youtu.be' in media.url|lower %}
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/{{ media.url|cut:'https://youtu.be/'|cut:'https://www.youtube.com/watch?v=' }}" frameborder="0" allowfullscreen></iframe>
            {% elif media.url|lower|slice:'-4:' == '.mp4' or media.url|lower|slice:'-5:' == '.webm' or media.url|lower|slice:'-4:' == '.ogg' %}
                <video controls class="max-w-full max-h-full object-contain">
                    <source src="{{ media.url }}">
                    Your browser does not support the video tag.
                </video>
            {% else %}
                <a href="{{ media.url }}" target="_blank">View Media</a>
            {% endif %}
        </div>
    {% endfor %}
{% endif %}

    <p>{{ post.content }}</p>
    <p class="post-meta">Created by {{ post.author }}</p>
    <p class="post-meta">Date: {{ post.date_of_event }}</p>
    <p class="post-meta">Location: {{ post.location }}</p>
    <p class="post-meta">Resources Needed: {{ post.resources_needed }}</p>
    <p class="post-meta">Sign-Up Link: <a href="{{ post.signup_link }}" target="_blank">{{ post.signup_link }}</a></p>

    <!-- PayPal Donation Button -->
    <form action="https://www.paypal.com/donate" method="post" target="_top" class="paypal-form">
        <input type="hidden" name="business" value="your-paypal-email@example.com">
        <input type="hidden" name="item_name" value="Premium Membership">
        <input type="hidden" name="currency_code" value="USD">
        <input type="submit" value="Pay with PayPal">
    </form>

    <hr>
    <h2>Discussion</h2>

    <div id="messages">
        {% for message in messages %}
            <div class="message">
                <strong>{{ message.author }}</strong> <em>{{ message.timestamp }}</em><br>
                {{ message.body|safe }}
                <div class="replies">
                    {% for reply in message.get_replies %}
                        <div class="reply">
                            <strong>{{ reply.author }}</strong> <em>{{ reply.timestamp }}</em><br>
                            {{ reply.body|safe }}
                        </div>
                    {% endfor %}
                </div>
                <form method="post" class="reply-form">
                    {% csrf_token %}
                    <input id="trix-body-{{ message.id }}" type="hidden" name="body" value="">
                    <trix-editor input="trix-body-{{ message.id }}" class="form-control"></trix-editor>
                    <input type="hidden" name="parent_id" value="{{ message.id }}">
                    <button type="submit">Reply</button>
                </form>
            </div>
        {% empty %}
            <p>No messages yet. Be the first to comment!</p>
        {% endfor %}
    </div>

    <h3>New Message</h3>
<form method="post" class="new-message-form">
    {% csrf_token %}
    <div class="editor-wrapper">
        <input id="trix-body-main" type="hidden" name="body" value="">
        <trix-editor input="trix-body-main" class="form-control"></trix-editor>
    </div>
    <button type="submit">Post Message</button>
</form>

</div>

{% endblock %}